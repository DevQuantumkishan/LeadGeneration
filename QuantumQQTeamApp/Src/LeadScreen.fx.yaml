LeadScreen As screen:
    OnVisible: |
        =Set(VarChatMessage,false);
        Set(VarLeadDetails,true);
        Set(VarLeadProposal,false);
        Set(VarLeadMessages,false);
        Set(VarPopUpEstimateNumber,false);
        Set(VarPopUpEstimateNumberResult,false);
        Set(VarPopUpEstimateNumberSubmitted,false);
        Set(
                VarNavigateDashboardScreen,
                false
            );
        Refresh(LeadInformations);
        Refresh(LeadImages);
        Refresh(LeadChats);

    ctnmainLdS As groupContainer.verticalAutoLayoutContainer:
        Height: =Parent.Height
        LayoutDirection: =LayoutDirection.Vertical
        LayoutGap: =7
        LayoutMode: =LayoutMode.Auto
        LayoutOverflowY: =LayoutOverflow.Scroll
        Width: =Parent.Width
        Y: =ctnHeaderLeadScreen.Height+ctnHeaderLeadScreen.Y
        ZIndex: =1

        ctnbackLdS As groupContainer.horizontalAutoLayoutContainer:
            AlignInContainer: =AlignInContainer.Start
            FillPortions: =0
            Height: =80
            LayoutAlignItems: =LayoutAlignItems.Center
            LayoutGap: =20
            LayoutMinHeight: =100
            LayoutMinWidth: =250
            LayoutMode: =LayoutMode.Auto
            PaddingLeft: =20
            Width: =Parent.Width
            ZIndex: =2

            btnbackLdS As button:
                BorderColor: =//ColorFade(Self.Fill, -15%)
                BorderThickness: =0
                Fill: =Header.SHRed
                FocusedBorderThickness: =0
                HoverFill: =//ColorFade(RGBA(56, 96, 178, 1), -20%)
                OnSelect: |-
                    =Set(VarPopUpInprogress,false);
                    //Reset(txtinptestimatenumber);
                    Navigate(LeadListScreen)
                PressedFill: =//Self.Color
                RadiusBottomLeft: =0
                RadiusBottomRight: =0
                RadiusTopLeft: =0
                RadiusTopRight: =0
                Text: =" Back"
                ZIndex: =1

        ctnmechanicnameLdS As groupContainer.horizontalAutoLayoutContainer:
            AlignInContainer: =AlignInContainer.SetByContainer
            FillPortions: =0
            Height: =40
            LayoutMinHeight: =100
            LayoutMinWidth: =250
            LayoutMode: =LayoutMode.Auto
            PaddingLeft: =20
            Width: =Parent.Width
            ZIndex: =3

            lblmechanicnameLdS As label:
                FontWeight: =FontWeight.Semibold
                Size: =16
                Text: ="Mechanic Name"
                Width: =200
                ZIndex: =1

            lblmechanicnamevalueLdS As label:
                Size: =16
                Text: =glryleadlistLS.Selected.MechanicName
                Width: =Parent.Width/2
                ZIndex: =2

        ctncontractnumberLdS As groupContainer.horizontalAutoLayoutContainer:
            AlignInContainer: =AlignInContainer.SetByContainer
            FillPortions: =0
            Height: =40
            LayoutMinHeight: =100
            LayoutMinWidth: =250
            LayoutMode: =LayoutMode.Auto
            PaddingLeft: =20
            Width: =Parent.Width
            ZIndex: =5

            lblcontractnumberLdS As label:
                FontWeight: =FontWeight.Semibold
                Size: =16
                Text: ="Lead Tracking No."
                Width: =200
                ZIndex: =1

            lblcontractnumbervalueLdS As label:
                Size: =16
                Text: =glryleadlistLS.Selected.LeadTrackingNumber
                Width: =Parent.Width/2
                ZIndex: =2

        ctnestimatenumberLdS As groupContainer.horizontalAutoLayoutContainer:
            AlignInContainer: =AlignInContainer.SetByContainer
            FillPortions: =0
            Height: =40
            LayoutMinHeight: =100
            LayoutMinWidth: =250
            LayoutMode: =LayoutMode.Auto
            PaddingLeft: =20
            Width: =Parent.Width
            ZIndex: =6

            lblestimatenumberLdS As label:
                FontWeight: =FontWeight.Semibold
                Size: =16
                Text: ="Estimate No."
                Width: =200
                ZIndex: =1

            lblestimatenumbervalueLdS As label:
                Size: =16
                Text: =If(IsBlank(glryleadlistLS.Selected.LeadEstimateNumber),"Pending",glryleadlistLS.Selected.LeadEstimateNumber)
                Width: =Parent.Width/2
                ZIndex: =2

        ctnqqteamnameLdS As groupContainer.horizontalAutoLayoutContainer:
            AlignInContainer: =AlignInContainer.SetByContainer
            FillPortions: =0
            Height: =40
            LayoutMinHeight: =100
            LayoutMinWidth: =250
            LayoutMode: =LayoutMode.Auto
            PaddingLeft: =20
            Width: =Parent.Width
            ZIndex: =7

            lblqqteamnameLdS As label:
                FontWeight: =FontWeight.Semibold
                Size: =16
                Text: ="QQ Team Name"
                Width: =200
                ZIndex: =1

            lblqqteamnamevalueLdS As label:
                Size: =16
                Text: =If(!IsBlank(LookUp(LeadInformations,LeadStatus="Submitted" && ID=glryleadlistLS.Selected.ID)),"Not Assigned",LookUp(LeadInformations,ID=glryleadlistLS.Selected.ID,QQTeamName))
                Width: =Parent.Width
                ZIndex: =2

        ctnglryheadingLdS As groupContainer.horizontalAutoLayoutContainer:
            AlignInContainer: =AlignInContainer.SetByContainer
            FillPortions: =0
            Height: =60
            LayoutMinHeight: =100
            LayoutMinWidth: =250
            LayoutMode: =LayoutMode.Auto
            Width: =Parent.Width //500
            ZIndex: =8

            ctnleaddetailstabLdS As groupContainer.verticalAutoLayoutContainer:
                AlignInContainer: =AlignInContainer.SetByContainer
                FillPortions: =0
                Height: =Parent.Height
                LayoutAlignItems: =LayoutAlignItems.Center
                LayoutDirection: =LayoutDirection.Vertical
                LayoutJustifyContent: =LayoutJustifyContent.Center
                LayoutMinHeight: =50
                LayoutMinWidth: =250
                LayoutMode: =LayoutMode.Auto
                Width: =180
                ZIndex: =1

                btnleaddetailstabLdS As button:
                    BorderThickness: =0
                    Color: =If(VarLeadDetails= true,Header.Black,Header.SHRed)
                    Fill: =Header.White
                    FocusedBorderThickness: =
                    HoverColor: =//RGBA(255, 255, 255, 1)
                    HoverFill: =//ColorFade(RGBA(56, 96, 178, 1), -20%)
                    OnSelect: |-
                        =Set(VarLeadDetails,true);
                        Set(VarLeadProposal,false);
                        Set(VarLeadMessages,false);
                    PressedFill: =//Self.Color
                    RadiusBottomLeft: =0
                    RadiusBottomRight: =0
                    RadiusTopLeft: =0
                    RadiusTopRight: =0
                    Text: ="Lead Details"
                    Width: =170
                    ZIndex: =1

                icnhorizontalleaddetailsLdS As icon.Add:
                    Color: =Header.SHRed
                    Fill: =Header.SHRed
                    Height: =3
                    Icon: =Icon.HorizontalLine
                    Visible: =If(VarLeadDetails= true,true,false)
                    Width: =150
                    ZIndex: =2

            ctnleadproposaltabLdS As groupContainer.verticalAutoLayoutContainer:
                AlignInContainer: =AlignInContainer.SetByContainer
                FillPortions: =0
                Height: =Parent.Height
                LayoutAlignItems: =LayoutAlignItems.Center
                LayoutDirection: =LayoutDirection.Vertical
                LayoutJustifyContent: =LayoutJustifyContent.Center
                LayoutMinHeight: =50
                LayoutMinWidth: =250
                LayoutMode: =LayoutMode.Auto
                Visible: =If((glryleadlistLS.Selected.LeadStatus="InProgress" /* || glryleadlistLS.Selected.LeadStatus="Rejected" ||glryleadlistLS.Selected.LeadStatus="Quoted"*/) && glryleadlistLS.Selected.QQTeamName=User().FullName,true,false)
                Width: =180
                ZIndex: =2

                btnleadproposaltabLdS As button:
                    BorderThickness: =0
                    Color: =If(VarLeadProposal= true,Header.Black,Header.Red)
                    Fill: =Header.White
                    FocusedBorderThickness: =
                    HoverColor: =//RGBA(255, 255, 255, 1)
                    HoverFill: =//ColorFade(RGBA(56, 96, 178, 1), -20%)
                    OnSelect: |
                        =Set(VarLeadDetails,false);
                        Set(VarLeadProposal,true);
                        Set(VarLeadMessages,false);
                    PressedFill: =//Self.Color
                    RadiusBottomLeft: =0
                    RadiusBottomRight: =0
                    RadiusTopLeft: =0
                    RadiusTopRight: =0
                    Text: ="Lead Proposal"
                    Width: =170
                    ZIndex: =1

                icnhorizontalleadproposalLdS As icon.Add:
                    Color: =Header.Red
                    Fill: =Header.Red
                    Height: =3
                    Icon: =Icon.HorizontalLine
                    Visible: =If(VarLeadProposal= true,true,false)
                    Width: =150
                    ZIndex: =2

            ctnleadmessagestabLdS As groupContainer.verticalAutoLayoutContainer:
                AlignInContainer: =AlignInContainer.SetByContainer
                FillPortions: =0
                Height: =Parent.Height
                LayoutAlignItems: =LayoutAlignItems.Center
                LayoutDirection: =LayoutDirection.Vertical
                LayoutJustifyContent: =LayoutJustifyContent.Center
                LayoutMinHeight: =50
                LayoutMinWidth: =250
                LayoutMode: =LayoutMode.Auto
                Width: =180
                ZIndex: =3

                btnleadmessagetabLdS As button:
                    BorderThickness: =0
                    Color: =If(VarLeadMessages= true,Header.Black,Header.SHRed)
                    Fill: =Header.White
                    FocusedBorderThickness: =
                    HoverColor: =//RGBA(255, 255, 255, 1)
                    HoverFill: =//ColorFade(RGBA(56, 96, 178, 1), -20%)
                    OnSelect: |-
                        =Refresh(LeadChats);
                        Set(VarLeadDetails,false);
                        Set(VarLeadProposal,false);
                        Set(VarLeadMessages,true);
                        ForAll(Filter(glrychatmessageLdS.AllItems,LeadInformationLID.ID=glryleadlistLS.Selected.ID && 'Read '='Read  (LeadChats)'.No && IsQQApp='IsQQApp (LeadChats)'.No) As i,
                        UpdateIf(LeadChats,ID=i.ID && LeadInformationLID.QQTeamName=User().FullName,{'Read ':true}));
                    PressedFill: =//Self.Color
                    RadiusBottomLeft: =0
                    RadiusBottomRight: =0
                    RadiusTopLeft: =0
                    RadiusTopRight: =0
                    Text: ="Lead Messages"
                    Width: =170
                    ZIndex: =1

                icnhorizontalleadmessageLdS As icon.Add:
                    Color: =Header.Red
                    Fill: =Header.Red
                    Height: =3
                    Icon: =Icon.HorizontalLine
                    Visible: =If(VarLeadMessages= true,true,false)
                    Width: =150
                    ZIndex: =2

            Container1 As groupContainer.horizontalAutoLayoutContainer:
                AlignInContainer: =AlignInContainer.Start
                Height: =Parent.Height
                LayoutJustifyContent: =LayoutJustifyContent.End
                LayoutMinHeight: =100
                LayoutMinWidth: =250
                LayoutMode: =LayoutMode.Auto
                PaddingRight: =40
                ZIndex: =4

                btnnewmessageLdS As button:
                    AlignInContainer: =AlignInContainer.Center
                    DisplayMode: |-
                        =//If((glryleadlistLS.Selected.LeadStatus="Quoted" || glryleadlistLS.Selected.LeadStatus="Rejected"),DisplayMode.Disabled,DisplayMode.Edit)
                        DisplayMode.Edit
                    Fill: =Header.SHRed
                    Height: =30
                    HoverFill: =//ColorFade(RGBA(56, 96, 178, 1), -20%)
                    OnSelect: =Set(VarChatMessage,true)
                    Text: ="+ New Message"
                    Visible: =VarLeadMessages
                    Width: =200
                    X: =Parent.Width-Self.Width-20
                    Y: =10
                    ZIndex: =1

        ctnhorizontallineleaddetailsglryLdS As groupContainer.horizontalAutoLayoutContainer:
            AlignInContainer: =AlignInContainer.SetByContainer
            FillPortions: =0
            Height: =2
            LayoutMinHeight: =100
            LayoutMinWidth: =250
            LayoutMode: =LayoutMode.Auto
            PaddingLeft: =20
            Width: =Parent.Width
            ZIndex: =9

            icnhorizontallineleaddetailsglryLdS As icon.AddDocument:
                Color: =RGBA(217, 217, 217, 1)
                Fill: =RGBA(217, 217, 217, 1)
                Height: =Parent.Height
                Icon: =Icon.HorizontalLine
                Width: =Parent.Width-40
                ZIndex: =1

        ctnglrymainLdS As groupContainer.manualLayoutContainer:
            AlignInContainer: =AlignInContainer.SetByContainer
            FillPortions: =0
            Height: =Parent.Height+500
            LayoutMinHeight: =100
            LayoutMinWidth: =250
            Width: =Parent.Width
            ZIndex: =10

            ctnchatmessageLdS As groupContainer.manualLayoutContainer:
                BorderColor: =RGBA(0, 0, 0, 0.16)
                BorderThickness: =2
                Fill: =RGBA(255,255,255,1) //RGBA(249, 249, 249, 1)
                Height: =Parent.Height
                Visible: =VarLeadMessages
                Width: =Parent.Width-40
                X: =20
                ZIndex: =1

                Label14_2 As label:
                    Color: =RGBA(255, 0, 0, 1)
                    Height: =200
                    Size: =50
                    Text: ="Comming Soon ...."
                    Visible: =false
                    Width: =800
                    X: =160
                    Y: =140
                    ZIndex: =1

                glrychatmessageLdS As gallery.variableTemplateHeightGallery:
                    DelayItemLoading: =true
                    Fill: |-
                        =//RGBA(237,237,237,1) 
                        RGBA(0, 0, 0, 0)
                    Height: =Parent.Height-100
                    Items: |-
                        =//Sort(Filter(Chats,LeadNo.crd59_leadinformationid=Gallery1.Selected.LeadInformation),Datetime,SortOrder.Ascending)
                        Sort(Filter(LeadChats,LeadInformationLID.ID=glryleadlistLS.Selected.ID),'Modified On',SortOrder.Descending)
                        /*[{
                            message:"Check doors again",
                            time:"12.59 AM",
                            name:"QQ Team",
                            from:"you"
                        },
                        {
                            message:"Gap problem",
                            time:"1.15 AM",
                            name:"Schindler guest",
                            from:"me"
                        },
                        {
                            message:"Okay",
                            time:"2.05 AM",
                            name:"QQ Team",
                            from:"you"
                        }
                        ]*/
                    Layout: =Layout.Vertical
                    LoadingSpinner: =LoadingSpinner.Data
                    OnSelect: |-
                        =/*Patch(Chats,
                                ThisItem,
                                {
                                   Read:true
                                }
                            );
                        
                        Set(MessageRead,true);
                        Refresh(Chats);*/
                    TemplateSize: =lblchatmessageLdS.Height+lblsenderreceiverLdS.Height
                    Width: =Parent.Width
                    Y: =//btnnewmessageLdS.Height+btnnewmessageLdS.Y+10
                    ZIndex: =2

                    rectmessageLdS As rectangle:
                        Fill: =If(ThisItem.IsQQApp=true,RGBA(255,255,255,1),RGBA(237, 237, 237, 1))
                        Height: =lblchatmessageLdS.Height+lblsenderreceiverLdS.Height
                        OnSelect: =Select(Parent)
                        Width: =Parent.Width-30
                        X: =10
                        ZIndex: =1

                    lblchatmessageLdS As label:
                        Align: =If(ThisItem.IsQQApp=true,Align.Right,Align.Left)
                        AutoHeight: =true
                        Font: =Font.Arial
                        Height: =25
                        OnSelect: =Select(Parent)
                        PaddingLeft: =20
                        PaddingRight: =50
                        Size: =18
                        Text: =ThisItem.Message
                        Width: =Parent.Width
                        ZIndex: =2

                    lblsenderreceiverLdS As label:
                        Align: =If(ThisItem.IsQQApp=true,Align.Right,Align.Left)
                        Font: =Font.Arial
                        Height: =30
                        OnSelect: =Select(Parent)
                        PaddingLeft: =20
                        PaddingRight: =50
                        Size: =14
                        Text: |-
                            =ThisItem.FromName & "  " &ThisItem.'Modified On'
                            //If(ThisItem.IsQQApp=true,ThisItem.FromName &  " " &ThisItem.'Modified On',ThisItem.ToName & " " & ThisItem.'Modified On')
                        Width: =Parent.Width
                        Y: =lblchatmessageLdS.Y+lblchatmessageLdS.Height
                        ZIndex: =3

                    rectmessagesepratorLdS As rectangle:
                        Fill: =RGBA(102, 102, 102, 1)
                        Height: =3
                        Width: =Parent.Width-30
                        X: =10
                        Y: =lblsenderreceiverLdS.Height+lblsenderreceiverLdS.Y+5
                        ZIndex: =4

                txtinptchatmessageldS As text:
                    BorderColor: =Self.Color
                    Color: =RGBA(255, 0, 0, 1)
                    Default: =""
                    Fill: =RGBA(0, 0, 0, 0)
                    Font: =Font.Arial
                    Height: =80
                    HintText: ="Enter message"
                    HoverBorderColor: =RGBA(255, 0, 0, 1)
                    HoverFill: =RGBA(0, 0, 0, 0)
                    Mode: =TextMode.MultiLine
                    Size: =18
                    Visible: =false
                    Width: =Parent.Width-130
                    X: =10
                    Y: =glrychatmessageLdS.Height+glrychatmessageLdS.Y
                    ZIndex: =3

                icnsendchatmessageLdS As icon.Send:
                    BorderColor: =Self.Color
                    BorderThickness: =2
                    Color: =RGBA(255, 0, 0, 1)
                    Height: =80
                    Icon: =Icon.Send
                    OnSelect: |-
                        =/*Patch(Chats,Defaults(Chats),
                                    {
                                        Name:"Chat",
                                        From:myMail,
                                     // To:personEmail,
                                        Message:TextInput1_2.Text,
                                        LeadNo:LookUp(LeadInformations,LeadInformation=Gallery1.Selected.LeadInformation),
                                        Datetime:Now()
                                    }
                                );
                        Refresh(Chats);
                        Reset(TextInput1_2);*/
                    PaddingBottom: =10
                    PaddingLeft: =15
                    PaddingRight: =15
                    PaddingTop: =10
                    Visible: =false
                    Width: =80
                    X: =txtinptchatmessageldS.Width+txtinptchatmessageldS.X
                    Y: =glrychatmessageLdS.Height+glrychatmessageLdS.Y
                    ZIndex: =4

            ctnapproverejectLdS As groupContainer.manualLayoutContainer:
                BorderColor: =RGBA(0, 0, 0, 0.16)
                BorderThickness: =2
                Fill: =RGBA(249, 249, 249, 1)
                Height: =Parent.Height
                Visible: =VarLeadProposal
                Width: =Parent.Width-40
                X: =20
                ZIndex: =4

                lbl_1 As label:
                    Height: =100
                    Size: =16
                    Text: ="Update lead status to send sales rep. requires Estimate Number to be entered. "
                    VerticalAlign: =VerticalAlign.Top
                    Visible: =false
                    Width: =800
                    X: =20
                    Y: =lblestimatenumberleaddetailsLdS.Height+lblestimatenumberleaddetailsLdS.Y
                    ZIndex: =1

                lblestimatenumberleaddetailsLdS As label:
                    Color: =RGBA(54, 176, 75, 1)
                    FontWeight: =FontWeight.Semibold
                    Height: =80
                    Size: =16
                    Text: ="Estimate Number"
                    Width: =200
                    X: =20
                    Y: =30
                    ZIndex: =2

                txtinptestimatenumber As text:
                    BorderColor: =RGBA(149, 149, 149, 1)
                    Color: =RGBA(116, 116, 116, 1)
                    Default: =If(IsBlank(LookUp(LeadInformations,ID=VarSelectedLead.ID,LeadEstimateNumber)),"",LookUp(LeadInformations,ID=VarSelectedLead.ID,LeadEstimateNumber))
                    Height: =60
                    HintText: ="Enter Estimate Number"
                    HoverBorderColor: =//RGBA(0, 18, 107, 1)
                    HoverFill: =//RGBA(186, 202, 226, 1)
                    MaxLength: =20
                    OnChange: =If(Len(txtinptestimatenumber)=20, Notify("Estimate number should not be greater than 11 digit."))
                    PaddingLeft: =20
                    X: =10
                    Y: =lblestimatenumberleaddetailsLdS.Height+lblestimatenumberleaddetailsLdS.Y //Label14_10.Height+Label14_10.Y
                    ZIndex: =3

                btnestimatenumberLdS As button:
                    DisplayMode: =If((glryleadlistLS.Selected.LeadStatus="InProgress" /*||glryleadlistLS.Selected.LeadStatus="Quoted"*/) && glryleadlistLS.Selected.QQTeamName=User().FullName,DisplayMode.Edit,DisplayMode.Disabled)
                    Fill: =RGBA(54, 176, 75, 1)
                    Height: =60
                    HoverFill: =//ColorFade(RGBA(56, 96, 178, 1), -20%)
                    OnSelect: |
                        =//here checking estimate number is entered or not
                        If(
                            IsBlank(txtinptestimatenumber.Text),
                            Notify(
                                "Please enter estimate number.",
                                NotificationType.Information
                            );
                            Set(
                                FlagEstimateNumberEntered,
                                false
                            ),
                            Set(
                                FlagEstimateNumberEntered,
                                true
                            )
                        );
                        //here checking if estimate number is entered then open confirmation popup
                        If(
                            FlagEstimateNumberEntered = true,
                            Set(
                                VarPopUpEstimateNumber,
                                true
                            );
                            ,
                            Set(
                                VarPopUpEstimateNumber,
                                false
                            );
                            
                        );
                    Text: ="Submit Estimate Number"
                    Width: =300
                    X: =410
                    Y: =lblestimatenumberleaddetailsLdS.Height+lblestimatenumberleaddetailsLdS.Y //Label14_10.Height+Label14_10.Y
                    ZIndex: =4

                lblrejectionLdS As label:
                    Color: =Header.SHRed
                    FontWeight: =FontWeight.Semibold
                    Height: =50
                    Size: =16
                    Text: ="Reject Lead"
                    Width: =200
                    X: =20
                    Y: =btnestimatenumberLdS.Height+btnestimatenumberLdS.Y+50
                    ZIndex: =5

                lblcommentLdS As label:
                    Height: =100
                    Size: =16
                    Text: ="Send Lead back to the Technician along with comments."
                    Width: =800
                    X: =20
                    Y: =lblrejectionLdS.Height+lblrejectionLdS.Y
                    ZIndex: =6

                txitnptrejectLdS As text:
                    BorderColor: =RGBA(149, 149, 149, 1)
                    Color: =RGBA(116, 116, 116, 1)
                    Default: =LookUp(LeadInformations,ID=glryleadlistLS.Selected.ID,LeadComment)
                    Height: =300
                    HintText: ="Add Rejection Comment"
                    HoverBorderColor: =//RGBA(0, 18, 107, 1)
                    HoverFill: =//RGBA(186, 202, 226, 1)
                    Mode: =TextMode.MultiLine
                    PaddingLeft: =20
                    PaddingTop: =20
                    Reset: =true
                    Width: =Parent.Width-100
                    X: =20
                    Y: =lblcommentLdS.Height+lblcommentLdS.Y
                    ZIndex: =7

                btnbacktotechnicianLdS As button:
                    DisplayMode: =If(glryleadlistLS.Selected.LeadStatus="InProgress" && glryleadlistLS.Selected.QQTeamName=User().FullName,DisplayMode.Edit,DisplayMode.Disabled)
                    Fill: =Header.SHRed
                    Height: =60
                    HoverFill: =//ColorFade(RGBA(56, 96, 178, 1), -20%)
                    OnSelect: |-
                        =//here checking if rejection comment is entered or not, if entered then update leadinfo table with comment,status and status date
                        If(
                            IsBlank(txitnptrejectLdS.Text),
                            Notify("Please enter rejection comment."),
                            UpdateIf(
                                LeadInformations,
                                ID = glryleadlistLS.Selected.ID,
                                {
                                    LeadComment: txitnptrejectLdS.Text,
                                    LeadStatus: "Rejected",
                                    StatusDate:Now()
                                }
                            );
                            LeadRejected.Run(glryleadlistLS.Selected.Email,glryleadlistLS.Selected.LeadTrackingNumber,VarLoggedInUser.FullName);
                            Notify("Lead rejected with comment successfully.");
                        )
                    Text: ="Submit back to Technician"
                    Width: =300
                    X: =410
                    Y: =txitnptrejectLdS.Height+txitnptrejectLdS.Y+40
                    ZIndex: =8

            ctnleaddetailsLdS As groupContainer.manualLayoutContainer:
                BorderColor: =RGBA(0, 0, 0, 0.16)
                BorderThickness: =2
                Fill: =RGBA(249, 249, 249, 1)
                Height: =Parent.Height
                Visible: =VarLeadDetails
                Width: =Parent.Width-40
                X: =20
                ZIndex: =5

                ctnvertleaddetailsLdS As groupContainer.verticalAutoLayoutContainer:
                    Height: =Parent.Height
                    LayoutDirection: =LayoutDirection.Vertical
                    LayoutMode: =LayoutMode.Auto
                    LayoutOverflowY: =LayoutOverflow.Scroll
                    Width: =Parent.Width
                    ZIndex: =1

                    ctnleaddateLdS As groupContainer.horizontalAutoLayoutContainer:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        FillPortions: =0
                        Height: =50
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        ZIndex: =1

                        lblleaddateLdS As label:
                            FontWeight: =FontWeight.Bold
                            Text: ="Lead Created Date "
                            Width: =200
                            ZIndex: =1

                        lblleaddatevalueldS As label:
                            FillPortions: =1
                            Text: |-
                                =Text(glryleadlistLS.Selected.'Created On',"yyyy/mm/dd hh:mm AM/PM")
                            ZIndex: =2

                    icnleadinfoleaddetailsLdS As icon.Add:
                        Color: =RGBA(217, 217, 217, 1)
                        Fill: =RGBA(217, 217, 217, 1)
                        Height: =2
                        Icon: =Icon.HorizontalLine
                        Width: =Parent.Width-20
                        ZIndex: =2

                    ctnleadstatusLdS As groupContainer.horizontalAutoLayoutContainer:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        FillPortions: =0
                        Height: =50
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        ZIndex: =3

                        lblleadstatusldS As label:
                            FontWeight: =FontWeight.Bold
                            Text: ="Lead Status "
                            Width: =200
                            ZIndex: =1

                        lblleadstatusLdS As label:
                            FillPortions: =1
                            Text: =If(glryleadlistLS.Selected.LeadStatus="InProgress","In Progress",glryleadlistLS.Selected.LeadStatus)
                            ZIndex: =2

                    icnleadinfoleaddetailsLdS_1 As icon.Add:
                        Color: =RGBA(217, 217, 217, 1)
                        Fill: =RGBA(217, 217, 217, 1)
                        Height: =2
                        Icon: =Icon.HorizontalLine
                        Width: =Parent.Width-20
                        ZIndex: =4

                    ctnleadstatusLdS_1 As groupContainer.horizontalAutoLayoutContainer:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        FillPortions: =0
                        Height: =50
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        Visible: =If(glryleadlistLS.Selected.LeadStatus="Rejected",true,false)
                        ZIndex: =5

                        lblleadstatusldS_1 As label:
                            FontWeight: =FontWeight.Bold
                            Text: ="Lead Comment "
                            Width: =200
                            ZIndex: =1

                        lblleadstatusLdS_1 As label:
                            FillPortions: =1
                            Text: =glryleadlistLS.Selected.LeadComment
                            ZIndex: =2

                    icnleadinfoleaddetailsLdS_2 As icon.Add:
                        Color: =RGBA(217, 217, 217, 1)
                        Fill: =RGBA(217, 217, 217, 1)
                        Height: =2
                        Icon: =Icon.HorizontalLine
                        Width: =Parent.Width-20
                        ZIndex: =6

                    ctnleadstatusdateLdS As groupContainer.horizontalAutoLayoutContainer:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        FillPortions: =0
                        Height: =50
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        ZIndex: =7

                        lblleadstatusdateLdS As label:
                            FontWeight: =FontWeight.Bold
                            Text: ="Lead Status Date "
                            Width: =200
                            ZIndex: =1

                        lblleadstatusdatevalueLdS As label:
                            FillPortions: =1
                            Text: |-
                                =Text(glryleadlistLS.Selected.StatusDate,"yyyy/mm/dd hh:mm AM/PM")
                            ZIndex: =2

                    icnleadinfoleaddetailsLdS_3 As icon.Add:
                        Color: =RGBA(217, 217, 217, 1)
                        Fill: =RGBA(217, 217, 217, 1)
                        Height: =2
                        Icon: =Icon.HorizontalLine
                        Width: =Parent.Width-20
                        ZIndex: =8

                    ctncontractnoLdS As groupContainer.horizontalAutoLayoutContainer:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        FillPortions: =0
                        Height: =50
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        ZIndex: =9

                        lblcontractnoLdS As label:
                            FontWeight: =FontWeight.Bold
                            Text: ="Contract No. "
                            Width: =200
                            ZIndex: =1

                        lblcontractnovalueLdS As label:
                            FillPortions: =1
                            Text: =glryleadlistLS.Selected.'ContractNumber '
                            ZIndex: =2

                    icnleadinfoleaddetailsLdS_4 As icon.Add:
                        Color: =RGBA(217, 217, 217, 1)
                        Fill: =RGBA(217, 217, 217, 1)
                        Height: =2
                        Icon: =Icon.HorizontalLine
                        Width: =Parent.Width-20
                        ZIndex: =10

                    ctnbuildingnameLdS As groupContainer.horizontalAutoLayoutContainer:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        FillPortions: =0
                        Height: =50
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        ZIndex: =11

                        lblbuildingnameLdS As label:
                            FontWeight: =FontWeight.Bold
                            Text: ="Building Name "
                            Width: =200
                            ZIndex: =1

                        lblbiuldingnamevalueLdS As label:
                            FillPortions: =1
                            Text: =glryleadlistLS.Selected.'BuildingName '
                            ZIndex: =2

                    icnleadinfoleaddetailsLdS_5 As icon.Add:
                        Color: =RGBA(217, 217, 217, 1)
                        Fill: =RGBA(217, 217, 217, 1)
                        Height: =2
                        Icon: =Icon.HorizontalLine
                        Width: =Parent.Width-20
                        ZIndex: =12

                    ctnaddressLds As groupContainer.horizontalAutoLayoutContainer:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        FillPortions: =0
                        Height: =50
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        ZIndex: =13

                        lbladdressLdS As label:
                            FontWeight: =FontWeight.Bold
                            Text: ="Address "
                            Width: =200
                            ZIndex: =1

                        lbladdressvalueLdS As label:
                            FillPortions: =1
                            Text: =glryleadlistLS.Selected.Address
                            ZIndex: =2

                    icnleadinfoleaddetailsLdS_6 As icon.Add:
                        Color: =RGBA(217, 217, 217, 1)
                        Fill: =RGBA(217, 217, 217, 1)
                        Height: =2
                        Icon: =Icon.HorizontalLine
                        Width: =Parent.Width-20
                        ZIndex: =14

                    ctnzipcodeLdS As groupContainer.horizontalAutoLayoutContainer:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        FillPortions: =0
                        Height: =50
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        Width: =Parent.Width
                        ZIndex: =15

                        lblzipcodeLdS As label:
                            FontWeight: =FontWeight.Bold
                            Text: ="Zip Code "
                            Width: =200
                            ZIndex: =1

                        lblzipcodevalueLdS As label:
                            Text: =glryleadlistLS.Selected.'ZipCode '
                            Width: =200
                            ZIndex: =2

                        Label1 As label:
                            FontWeight: =FontWeight.Bold
                            Text: ="Area"
                            Width: =100
                            ZIndex: =3

                        Label2 As label:
                            Text: =glryleadlistLS.Selected.Area
                            ZIndex: =4

                        Label3 As label:
                            FontWeight: =FontWeight.Bold
                            Text: ="Territory"
                            Width: =100
                            ZIndex: =5

                        Label4 As label:
                            Text: =glryleadlistLS.Selected.Territory
                            ZIndex: =6

                        Label5 As label:
                            FontWeight: =FontWeight.Bold
                            Text: ="District"
                            Width: =100
                            ZIndex: =7

                        Label6 As label:
                            Text: =glryleadlistLS.Selected.District
                            ZIndex: =8

                    icnleadinfoleaddetailsLdS_7 As icon.Add:
                        Color: =RGBA(217, 217, 217, 1)
                        Fill: =RGBA(217, 217, 217, 1)
                        Height: =2
                        Icon: =Icon.HorizontalLine
                        Width: =Parent.Width-20
                        ZIndex: =16

                    ctnnoofunitLdS As groupContainer.horizontalAutoLayoutContainer:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        FillPortions: =0
                        Height: =50
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        ZIndex: =17

                        lblnoofunitLdS As label:
                            FontWeight: =FontWeight.Bold
                            Text: ="No. of Unit "
                            Width: =200
                            ZIndex: =1

                        lblnoofunitvalueLdS As label:
                            FillPortions: =1
                            Text: =glryleadlistLS.Selected.NumberofUnits
                            ZIndex: =2

                    icnleadinfoleaddetailsLdS_8 As icon.Add:
                        Color: =RGBA(217, 217, 217, 1)
                        Fill: =RGBA(217, 217, 217, 1)
                        Height: =2
                        Icon: =Icon.HorizontalLine
                        Width: =Parent.Width-20
                        ZIndex: =18

                    ctnunitdescriptionLdS As groupContainer.horizontalAutoLayoutContainer:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        FillPortions: =0
                        Height: =50
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        ZIndex: =19

                        lblunitdescriptionLdS As label:
                            FontWeight: =FontWeight.Bold
                            Text: ="Unit Description "
                            Width: =200
                            ZIndex: =1

                        lblunitdescriptionvalueLdS As label:
                            AutoHeight: =true
                            FillPortions: =1
                            Text: =glryleadlistLS.Selected.UnitDescription
                            ZIndex: =2

                    icnleadinfoleaddetailsLdS_9 As icon.Add:
                        Color: =RGBA(217, 217, 217, 1)
                        Fill: =RGBA(217, 217, 217, 1)
                        Height: =2
                        Icon: =Icon.HorizontalLine
                        Width: =Parent.Width-20
                        ZIndex: =20

                    ctnprimaryscopeLdS As groupContainer.horizontalAutoLayoutContainer:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        FillPortions: =0
                        Height: =50
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        ZIndex: =21

                        lblprimaryscopeLdS As label:
                            FontWeight: =FontWeight.Bold
                            Text: ="Primary Scope "
                            Width: =200
                            ZIndex: =1

                        lblprimaryscopevalueLdS As label:
                            FillPortions: =1
                            Text: =glryleadlistLS.Selected.PrimaryScopeofWorkLID.'PrimaryScopeofWorkName '
                            ZIndex: =2

                    icnleadinfoleaddetailsLdS_10 As icon.Add:
                        Color: =RGBA(217, 217, 217, 1)
                        Fill: =RGBA(217, 217, 217, 1)
                        Height: =2
                        Icon: =Icon.HorizontalLine
                        Width: =Parent.Width-20
                        ZIndex: =22

                    ctnsecondaryscopeLdS As groupContainer.horizontalAutoLayoutContainer:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        FillPortions: =0
                        Height: =50
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        ZIndex: =23

                        lblsecondaryscopeLdS As label:
                            FontWeight: =FontWeight.Bold
                            Text: ="Secondary Scope "
                            Width: =200
                            ZIndex: =1

                        lblsecondaryscopevalueLdS As label:
                            FillPortions: =1
                            Text: =glryleadlistLS.Selected.SecondaryScopeofWorkLID.'SecondaryScopeofWorkName '
                            ZIndex: =2

                    icnleadinfoleaddetailsLdS_11 As icon.Add:
                        Color: =RGBA(217, 217, 217, 1)
                        Fill: =RGBA(217, 217, 217, 1)
                        Height: =2
                        Icon: =Icon.HorizontalLine
                        Width: =Parent.Width-20
                        ZIndex: =24

                    ctncustomscopeLdS As groupContainer.horizontalAutoLayoutContainer:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        FillPortions: =0
                        Height: =50
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        Visible: =If(IsBlank(glryleadlistLS.Selected.CustomScopeofWork),false,true)
                        ZIndex: =25

                        lblcustomscopeLdS As label:
                            FontWeight: =FontWeight.Bold
                            Text: ="Custom Scope "
                            Width: =200
                            ZIndex: =1

                        lblcustomscopevalueLdS As label:
                            AutoHeight: =true
                            FillPortions: =1
                            Text: =glryleadlistLS.Selected.CustomScopeofWork
                            ZIndex: =2

                    icnleadinfoleaddetailsLdS_12 As icon.Add:
                        Color: =RGBA(217, 217, 217, 1)
                        Fill: =RGBA(217, 217, 217, 1)
                        Height: =2
                        Icon: =Icon.HorizontalLine
                        Width: =Parent.Width-20
                        ZIndex: =26

                    ctnestimatedhoursLds As groupContainer.horizontalAutoLayoutContainer:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        FillPortions: =0
                        Height: =50
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        ZIndex: =27

                        lblestimatedhoursLdS As label:
                            FontWeight: =FontWeight.Bold
                            Text: ="Estimated Hours "
                            Width: =200
                            ZIndex: =1

                        lblestimatedhoursvalueLdS As label:
                            FillPortions: =1
                            Text: =glryleadlistLS.Selected.'EstimatedHours '
                            ZIndex: =2

                    icnleadinfoleaddetailsLdS_13 As icon.Add:
                        Color: =RGBA(217, 217, 217, 1)
                        Fill: =RGBA(217, 217, 217, 1)
                        Height: =2
                        Icon: =Icon.HorizontalLine
                        Width: =Parent.Width-20
                        ZIndex: =28

                    ctnnotesLdS As groupContainer.horizontalAutoLayoutContainer:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        FillPortions: =0
                        Height: =70
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        ZIndex: =29

                        lblnotesLdS As label:
                            FontWeight: =FontWeight.Bold
                            Height: =70
                            Text: ="Material / Parts Required / Comments"
                            Width: =200
                            ZIndex: =1

                        lblnotesvalueLdS As label:
                            AutoHeight: =true
                            FillPortions: =1
                            Text: =glryleadlistLS.Selected.Notes
                            ZIndex: =2

                    icnleadinfoleaddetailsLdS_14 As icon.Add:
                        Color: =RGBA(217, 217, 217, 1)
                        Fill: =RGBA(217, 217, 217, 1)
                        Height: =2
                        Icon: =Icon.HorizontalLine
                        Width: =Parent.Width-20
                        ZIndex: =30

                    ctncheckboxesLdS As groupContainer.horizontalAutoLayoutContainer:
                        AlignInContainer: =AlignInContainer.SetByContainer
                        LayoutMinHeight: =100
                        LayoutMinWidth: =250
                        LayoutMode: =LayoutMode.Auto
                        Width: =Parent.Width
                        ZIndex: =31

                        ctnvertcheckboxesLdS As groupContainer.verticalAutoLayoutContainer:
                            AlignInContainer: =AlignInContainer.SetByContainer
                            FillPortions: =0
                            Height: =600
                            LayoutDirection: =LayoutDirection.Vertical
                            LayoutMinHeight: =100
                            LayoutMinWidth: =250
                            LayoutMode: =LayoutMode.Auto
                            ZIndex: =1

                            chbxunitdownLdS As checkbox:
                                CheckboxBorderColor: =RGBA(0, 0, 0, 1)
                                Default: =true
                                DisplayMode: =DisplayMode.View
                                FocusedBorderThickness: =//2
                                FontWeight: =FontWeight.Bold
                                PressedBorderColor: =//ColorFade(Self.BorderColor, -30%)
                                Text: ="Unit Down"
                                Visible: =If(glryleadlistLS.Selected.IsUnitDown= 'IsUnitDown (LeadInformations)'.Yes,true,false)
                                Width: =Parent.Width
                                ZIndex: =1

                            chbxadditionalexpensesLdS As checkbox:
                                CheckboxBorderColor: =RGBA(0, 0, 0, 1)
                                Default: =true
                                DisplayMode: =DisplayMode.View
                                FocusedBorderThickness: =//2
                                FontWeight: =FontWeight.Bold
                                PressedBorderColor: =//ColorFade(Self.BorderColor, -30%)
                                Text: ="Additional expenses required"
                                Visible: =If(glryleadlistLS.Selected.AdditionalExpensesRequired= 'AdditionalExpensesRequired (LeadInformations)'.Yes,true,false)
                                Width: =Parent.Width
                                ZIndex: =2

                            lbltotalestimatedexpensesLdS As label:
                                FontWeight: =FontWeight.Semibold
                                Text: ="Total estimated expense"
                                Visible: =If(glryleadlistLS.Selected.AdditionalExpensesRequired= 'AdditionalExpensesRequired (LeadInformations)'.Yes,true,false)
                                Width: =300
                                ZIndex: =3

                            lbltotalestimatedexpensesvalueLdS As label:
                                Text: =glryleadlistLS.Selected.TotalEstimatedExpense
                                Visible: =If(glryleadlistLS.Selected.AdditionalExpensesRequired= 'AdditionalExpensesRequired (LeadInformations)'.Yes,true,false)
                                Width: =Parent.Width
                                ZIndex: =4

                            chbxtravelrequiredLdS As checkbox:
                                CheckboxBorderColor: =RGBA(0, 0, 0, 1)
                                Default: =true
                                DisplayMode: =DisplayMode.View
                                FocusedBorderThickness: =//2
                                FontWeight: =FontWeight.Bold
                                PressedBorderColor: =//ColorFade(Self.BorderColor, -30%)
                                Text: ="Travel Required"
                                Visible: =If(glryleadlistLS.Selected.TravelRequired='TravelRequired (LeadInformations)'.Yes,true,false)
                                Width: =Parent.Width
                                ZIndex: =5

                            lbltotalestihoursLdS As label:
                                FontWeight: =FontWeight.Semibold
                                Text: ="Total estimated hours of travel"
                                Visible: =If(glryleadlistLS.Selected.TravelRequired='TravelRequired (LeadInformations)'.Yes,true,false)
                                Width: =300
                                ZIndex: =6

                            lbltotalestihoursvalueLdS As label:
                                Text: =glryleadlistLS.Selected.TotalEstimatedHoursofTravel
                                Visible: =If(glryleadlistLS.Selected.TravelRequired='TravelRequired (LeadInformations)'.Yes,true,false)
                                ZIndex: =7

                            chbxcommunucationLdS As checkbox:
                                CheckboxBorderColor: =RGBA(0, 0, 0, 1)
                                Default: =true
                                DisplayMode: =DisplayMode.View
                                FocusedBorderThickness: =//2
                                FontWeight: =FontWeight.Bold
                                PressedBorderColor: =//ColorFade(Self.BorderColor, -30%)
                                Text: ="Communicated to Customer"
                                Visible: =If(glryleadlistLS.Selected.CommunicatedToCustomer = 'CommunicatedToCustomer (LeadInformations)'.Yes,true,false)
                                Width: =Parent.Width
                                ZIndex: =8

                            lblcustnameLdS As label:
                                FontWeight: =FontWeight.Semibold
                                Text: ="Customer Name"
                                Visible: =If(glryleadlistLS.Selected.CommunicatedToCustomer = 'CommunicatedToCustomer (LeadInformations)'.Yes,true,false)
                                Width: =300
                                ZIndex: =9

                            lblcustnamevalueLdS As label:
                                Text: =glryleadlistLS.Selected.'CustomerName '
                                Visible: =If(glryleadlistLS.Selected.CommunicatedToCustomer = 'CommunicatedToCustomer (LeadInformations)'.Yes,true,false)
                                ZIndex: =10

                            lblcustcontactLdS As label:
                                FontWeight: =FontWeight.Semibold
                                Text: ="Customer Contact"
                                Visible: =If(glryleadlistLS.Selected.CommunicatedToCustomer = 'CommunicatedToCustomer (LeadInformations)'.Yes,true,false)
                                Width: =300
                                ZIndex: =11

                            lblcustcontactvalueLdS As label:
                                Text: =glryleadlistLS.Selected.'CustomerContact '
                                Visible: =If(glryleadlistLS.Selected.CommunicatedToCustomer = 'CommunicatedToCustomer (LeadInformations)'.Yes,true,false)
                                ZIndex: =12

                            chbxsafetyLdS As checkbox:
                                BorderColor: =RGBA(0, 0, 0, 1)
                                CheckboxBorderColor: =RGBA(0, 0, 0, 1)
                                Default: =true
                                DisplayMode: =DisplayMode.View
                                FocusedBorderThickness: =//2
                                FontWeight: =FontWeight.Bold
                                PressedBorderColor: =//ColorFade(Self.BorderColor, -30%)
                                Text: ="Safety"
                                Visible: =If(glryleadlistLS.Selected.Safety='Safety (LeadInformations)'.Yes,true,false)
                                Width: =Parent.Width
                                ZIndex: =13

                        ctnphotoglryLdS As groupContainer.verticalAutoLayoutContainer:
                            AlignInContainer: =AlignInContainer.Start
                            Height: =lblphotosLdS.Height+glryphotosLdS.Height+20
                            LayoutDirection: =LayoutDirection.Vertical
                            LayoutMinHeight: =100
                            LayoutMinWidth: =250
                            LayoutMode: =LayoutMode.Auto
                            PaddingLeft: =10
                            ZIndex: =2

                            lblphotosLdS As label:
                                FontWeight: =FontWeight.Bold
                                Height: =50
                                Text: ="Photos "
                                Visible: =If(CountRows(Filter(LeadImages,LeadInformationLID.ID=glryleadlistLS.Selected.ID))>0,true,false)
                                Width: =Parent.Width
                                ZIndex: =1

                            "glryphotosLdS As gallery.'BrowseLayout_Horizontal_TwoTextOneImageOverlayVariant_ver4.0'":
                                AlignInContainer: =AlignInContainer.Start
                                BorderColor: =RGBA(255, 0, 0, 1)
                                FillPortions: =0
                                Height: =230
                                Items: |
                                    =Filter(LeadImages,LeadInformationLID.ID=glryleadlistLS.Selected.ID)
                                LayoutMinHeight: =287
                                LayoutMinWidth: =320
                                TemplatePadding: =0
                                TemplateSize: =Min(440, Self.Height - 60)
                                Width: =Parent.Width-40
                                ZIndex: =2

                                imgglryphotosLdS As image:
                                    BorderColor: =RGBA(26, 26, 26, 1)
                                    BorderThickness: =2
                                    Height: =Parent.TemplateHeight -10
                                    Image: |
                                        =ThisItem.Images
                                    OnSelect: |-
                                        =UpdateContext({MyBigPic: ThisItem.Images.Full});UpdateContext({MyBigPicShow:true})
                                    Width: =Parent.TemplateWidth -10
                                    X: =5
                                    Y: =5
                                    ZIndex: =1

        ctn As groupContainer.horizontalAutoLayoutContainer:
            AlignInContainer: =AlignInContainer.SetByContainer
            FillPortions: =0
            Height: =100
            LayoutMinHeight: =100
            LayoutMinWidth: =250
            LayoutMode: =LayoutMode.Auto
            X: =19
            Y: =ctnmainLdS.Height+ctnmainLdS.Y
            ZIndex: =11

    ctnHeaderLeadScreen As groupContainer.manualLayoutContainer:
        Fill: =Header.SHRed
        Height: =80
        Width: =Parent.Width
        ZIndex: =2

        imguserLdS As image:
            Fill: =RGBA(253, 222, 207, 1)
            Height: =50
            Image: |-
                =//'man-avatar'
                User().Image
            RadiusBottomLeft: =91
            RadiusBottomRight: =91
            RadiusTopLeft: =91
            RadiusTopRight: =91
            Width: =50
            X: =lblheaderLdS.X+lblheaderLdS.Width
            Y: =16
            ZIndex: =1

        lblusernameLdS As label:
            Align: =Align.Center
            Color: =Header.White
            FontWeight: =FontWeight.Semibold
            Height: =Parent.Height
            Text: |-
                =//"Hi Sam Martin"
                User().FullName
            Width: =ctnHeaderLeadScreen.Width/8
            X: =imguserLdS.X+ imguserLdS.Height
            ZIndex: =2

        lblheaderLdS As label:
            Align: =Align.Center
            Color: =Header.White
            Fill: =Header.SHRed
            FontWeight: =FontWeight.Bold
            Height: =Parent.Height
            Size: =26
            Text: =If(VarMyLeads=true,"My Lead Detail Information",VarOpenLeads=true,"Open Lead Detail Information",VarQuotedLeads=true,"Quoted Lead Detail Information",VarSoldLeads=true,"Sold Lead Detail Innformation")
            Width: =ctnHeaderLeadScreen.Width/1.5
            X: =imgSchindlerlogoLdS.Width+imgSchindlerlogoLdS.X
            ZIndex: =3

        imgSchindlerlogoLdS As image:
            Fill: =RGBA(255, 255, 255, 1)
            Height: =Parent.Height
            Image: =SchindlerImage
            PaddingBottom: =5
            PaddingLeft: =2
            PaddingRight: =1
            PaddingTop: =5
            Width: =ctnHeaderLeadScreen.Width/10
            ZIndex: =4

    grpchatmessageLdS As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =10

        rectfullchatmessageLdS As rectangle:
            Fill: =RGBA(0, 0, 0, 0.29)
            Height: =Parent.Height
            Visible: =VarChatMessage
            Width: =Parent.Width
            ZIndex: =3

        rectchatmessage1LdS As rectangle:
            Fill: =RGBA(255, 255, 255, 1)
            Height: =405
            Visible: =VarChatMessage
            Width: =700
            X: =(Parent.Width -Self.Width)/2
            Y: =(Parent.Height - Self.Height)/2
            ZIndex: =4

        ctnchatmessageheadingLdS As groupContainer.horizontalAutoLayoutContainer:
            Height: =50
            LayoutMode: =LayoutMode.Auto
            Visible: =VarChatMessage
            Width: =rectchatmessage1LdS.Width
            X: =rectchatmessage1LdS.X
            Y: =rectchatmessage1LdS.Y+10
            ZIndex: =5

            lblchatmessageheadingLdS As label:
                FontWeight: =FontWeight.Semibold
                PaddingLeft: =20
                Text: |-
                    ="Enter message to Technician : " & glryleadlistLS.Selected.MechanicName
                Width: =Parent.Width-70
                ZIndex: =1

            icnclosechatmessageLdS As icon.Cancel:
                Color: =RGBA(153, 153, 153, 1)
                Height: =35
                Icon: =Icon.Cancel
                OnSelect: |-
                    =Set(VarChatMessage,false);
                    Reset(txtinptchatmessageLdS);
                Width: =30
                ZIndex: =2

        rectchatmessageLdS As rectangle:
            BorderColor: =RGBA(179, 179, 179, 1)
            BorderThickness: =2
            Fill: =RGBA(255, 255, 255, 1)
            Height: =250
            Visible: =VarChatMessage
            Width: =656
            X: =rectchatmessage1LdS.X+20
            Y: =ctnchatmessageheadingLdS.Y+ctnchatmessageheadingLdS.Height +10
            ZIndex: =6

        icnhorizontallineLdS As icon.Add:
            Color: =RGBA(179, 179, 179, 1)
            Fill: =RGBA(179, 179, 179, 1)
            Height: =2
            Icon: =Icon.HorizontalLine
            Visible: =VarChatMessage
            Width: =rectchatmessageLdS.Width
            X: =rectchatmessageLdS.X
            Y: =rectchatmessageLdS.Y +rectchatmessageLdS.Height+10
            ZIndex: =7

        btnsendchatmessageLdS As button:
            BorderThickness: =0
            DisabledFill: =RGBA(237, 237, 237, 1)
            DisplayMode: |-
                =If(
                    Connection.Connected,
                    DisplayMode.Edit,
                    DisplayMode.Disabled
                )
            Fill: =Header.SHRed
            FocusedBorderThickness: =
            HoverFill: =//ColorFade(RGBA(56, 96, 178, 1), -20%)
            OnSelect: |+
                =//here checking message is entered or not, if entered then insert row in leadchat table
                If(IsBlank(txtinptchatmessageLdS.Text),
                Notify("Please enter message to send",NotificationType.Warning); ,
                Patch(LeadChats,Defaults(LeadChats),
                {
                    ID:GUID(),
                    Message:txtinptchatmessageLdS.Text,
                    FromEmail:User().Email,
                    FromName:User().FullName,
                    ToEmail:glryleadlistLS.Selected.Email,
                    ToName:glryleadlistLS.Selected.MechanicName,
                    LeadInformationLID:LookUp(LeadInformations,ID=glryleadlistLS.Selected.ID),
                    IsQQApp:true
                });
                TechnicianMessage.Run(glryleadlistLS.Selected.Email,User().FullName,glryleadlistLS.Selected.LeadTrackingNumber);
                If(
                        (!IsEmpty(Errors(LeadChats))),
                        Notify(
                            "Sending message Patch function Error -- " & Concat(
                                Errors(LeadChats),
                                Column & ": " & Message
                            ),
                            NotificationType.Error
                        );
                        ,
                        Reset(txtinptchatmessageLdS);
                Set(VarChatMessage,false);
                Notify("Message send successfully.",NotificationType.Success);
                    );
                );
                
                
                
            PressedColor: =Self.Color
            PressedFill: =Self.Fill
            Text: ="Send Message"
            Visible: =VarChatMessage
            X: =(Parent.Width-Self.Width)/2
            Y: =icnhorizontallineLdS.Y+20
            ZIndex: =8

        txtinptchatmessageLdS As text:
            BorderThickness: =0
            Default: =
            Fill: =RGBA(255,255,255,1)
            FocusedBorderColor: =RGBA(179, 179, 179, 1)
            FocusedBorderThickness: =2
            Height: =rectchatmessageLdS.Height
            HintText: ="Type here ..."
            HoverBorderColor: =RGBA(179, 179, 179, 1)
            HoverFill: =RGBA(0, 0, 0, 0)
            Mode: =TextMode.MultiLine
            OnChange: |-
                =ForAll(Filter(glrychatmessageLdS.AllItems,LeadInformationLID.ID=glryleadlistLS.Selected.ID && 'Read '='Read  (LeadChats)'.No && IsQQApp='IsQQApp (LeadChats)'.No) As i,
                UpdateIf(LeadChats,ID=i.ID,{'Read ':true}));
            PressedBorderColor: =RGBA(179, 179, 179, 1)
            RadiusBottomLeft: =20
            RadiusBottomRight: =20
            RadiusTopLeft: =20
            RadiusTopRight: =20
            Reset: =true
            Visible: =VarChatMessage
            Width: =rectchatmessageLdS.Width
            X: =rectchatmessageLdS.X
            Y: =rectchatmessageLdS.Y
            ZIndex: =9

    tmrgetmessage As timer:
        AutoPause: =false
        AutoStart: =VarLeadMessages
        Duration: =3000
        OnTimerEnd: =Refresh(LeadChats);
        Repeat: =true
        Start: =VarLeadMessages
        Visible: =false
        X: =40
        Y: =40
        ZIndex: =13

    grpZoomPhotoPopUpLdS As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =13

        rectimgzoomLdS As rectangle:
            Fill: =RGBA(255, 255, 255, 1)
            Height: =Parent.Height
            Visible: = If(Len(Text(MyBigPicShow)) = 0,false,MyBigPicShow) 
            Width: =Parent.Width
            ZIndex: =10

        imgZoomLdS As image:
            Height: =Parent.Height
            Image: =MyBigPic 
            Visible: = If(Len(Text(MyBigPicShow)) = 0,false,MyBigPicShow) 
            Width: =Parent.Width
            ZIndex: =11

        btncancleLdS As button:
            Color: =RGBA(102, 102, 102, 1)
            Fill: =RGBA(0, 0, 0, 0)
            FontWeight: =FontWeight.Normal
            Height: =100
            HoverColor: =//RGBA(255, 255, 255, 1)
            HoverFill: =//ColorFade(RGBA(56, 96, 178, 1), -20%)
            OnSelect: |-
                =UpdateContext({MyBigPicShow:false})
            Size: =50
            Text: ="X"
            Visible: = If(Len(Text(MyBigPicShow)) = 0,false,MyBigPicShow)
            Width: =100
            X: =Parent.Width-Self.Width
            ZIndex: =12

    grpEstimateNumberEnteringconfirmationLdS As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =20

        rectfullestimatenumberenteringLdS As rectangle:
            Fill: =RGBA(0, 0, 0, 0.29)
            Height: =Parent.Height
            Visible: =VarPopUpEstimateNumber
            Width: =Parent.Width
            ZIndex: =14

        rectestimatenumberenteringLdS As rectangle:
            Fill: =RGBA(255, 255, 255, 1)
            Height: =280
            Visible: =VarPopUpEstimateNumber
            Width: =400
            X: =(Parent.Width-Self.Width)/2
            Y: =Parent.Height/3
            ZIndex: =15

        imginfoLdS As image:
            Height: =52
            Image: =images
            Visible: =VarPopUpEstimateNumber
            Width: =52
            X: =(Parent.Width-Self.Width)/2
            Y: =rectestimatenumberenteringLdS.Y+20
            ZIndex: =16

        lblmsgLdS As label:
            Align: =Align.Center
            Font: =Font.Arial
            FontWeight: =FontWeight.Bold
            Height: =110
            Size: =15
            Text: ="Do you want to enter estimate number "& txtinptestimatenumber.Text & ", please confirm it."
            Visible: =VarPopUpEstimateNumber
            Width: =350
            X: =(Parent.Width-Self.Width)/2
            Y: =imginfoLdS.Y+ imginfoLdS.Height+2
            ZIndex: =17

        btnyesLdS As button:
            Fill: =RGBA(54, 176, 75, 1)
            Font: =Font.Arial
            HoverFill: =RGBA(75, 125, 6, 1)
            OnSelect: |
                =//By confirming set VarPopUpEstimateNumberResult variable to true
                Set(
                    VarPopUpEstimateNumberResult,
                    true
                );
                If(
                    VarPopUpEstimateNumberResult = true,
                //checking in fpestimate file, is entered estimate number is available or not 
                    If(
                        !IsBlank(
                            LookUp(
                                SHFPEstimates,
                                Estimate = txtinptestimatenumber.Text
                            )
                        ),
                        Set(
                            FlagEstimateNumberFound,
                            true
                        );
                        //here checking estimate number with tech id in fpestimate file
                If(
                            !IsBlank(
                                LookUp(
                                    SHFPEstimates,
                                    Estimate = txtinptestimatenumber.Text && 'Lead Generator Id' = VarSelectedLead.TechnicianID
                                )
                            ),
                            Set(
                                FlagEstimateNumberWithTechIdFound,
                                true
                            );
                            Set(
                                VarFPEstimateData,
                                LookUp(
                                    SHFPEstimates,
                                    Estimate = txtinptestimatenumber.Text
                                )
                            );
                            ,
                            Set(
                                FlagEstimateNumberWithTechIdFound,
                                false
                            );
                        //Notify("Estimate number not found in the FP Estimate file for this lead Technician is entered.");
                Set(
                                VarPopUpEstimateNumberSubmittedmsg,
                                "Technician Id of this lead is not matching with that of FPEstimate file"
                            );
                            Set(
                                VarPopUpEstimateNumberSubmitted,
                                true
                            );
                        );
                        ,
                        Set(
                            FlagEstimateNumberFound,
                            false
                        );
                    );
                    //estimate number found if close
                );
                //estimatenumber entered if close
                If(
                    FlagEstimateNumberFound = false,
                //If Estimate number is not found in FP Estimate file then we are storing estimate nummber only.
                    UpdateIf(
                        LeadInformations,
                        ID = VarSelectedLead.ID,
                        {LeadEstimateNumber: txtinptestimatenumber.Text}
                    );
                    Set(
                        VarPopUpEstimateNumberSubmittedmsg,
                        "Estimate number of this lead is not found in FP Estimate file, Estimate number is saved successfully. Incentives will be calculated in the next processing cycle of FPEstimate file."
                    );
                    Set(
                        VarPopUpEstimateNumberSubmitted,
                        true
                    );
                    
                );
                //here checking FlagEstimateNumberWithTechIdFound is true then update estimate number,leadprice,leadincentive
                If(
                    FlagEstimateNumberWithTechIdFound = true,
                    If(
                        !IsBlank(
                            LookUp(
                                SHFPEstimates,
                                Estimate = txtinptestimatenumber.Text && 'Lead Generator Id' = VarSelectedLead.TechnicianID && JobStatus = "Open"
                            )
                        ),
                        //Updating proposed price and proposed incentives
                        LeadQuoted.Run(
                            glryleadlistLS.Selected.Email,
                            glryleadlistLS.Selected.LeadTrackingNumber,
                            VarLoggedInUser.FullName
                        );
                        UpdateIf(
                            LeadInformations,
                            ID = VarSelectedLead.ID,
                            {
                                LeadEstimateNumber: txtinptestimatenumber.Text,
                                LeadStatus: "Quoted",
                                ProposedLeadPrice: VarFPEstimateData.BidPrice,
                                ProposedLeadIncentives: VarFPEstimateData.BidPrice * 0.02,
                                //TechnicianID: VarFPEstimateData.'Lead Generator Id',
                                StatusDate: Now(),
                                ProposedLeadDate: VarFPEstimateData.DateCreated
                                //Area:VarFPEstimateData.Area,
                //Territory:VarFPEstimateData.Territory
                            }
                        );
                        If(
                            CountRows(
                                Filter(
                                    TotalIncentives,
                                    TechnicianID = VarFPEstimateData.'Lead Generator Id' && Year = Text(Year(VarFPEstimateData.DateCreated))
                                )
                            ) < 1,
                            Patch(
                                TotalIncentives,
                                Defaults(TotalIncentives),
                                {
                                    ID: GUID(),
                                    TechnicianID: VarFPEstimateData.'Lead Generator Id',
                                    TotalproposedIncentives: VarFPEstimateData.BidPrice * 0.02,
                                    TotalProposedLead: 1,
                                    TotalSoldIncentives: 0.00,
                                    TotalSoldLead: 0,
                                    Year: Year(VarFPEstimateData.DateCreated),
                                    LeadYear: Year(VarFPEstimateData.DateCreated)
                                }
                            ),
                            UpdateIf(
                                TotalIncentives,
                                TechnicianID = VarFPEstimateData.'Lead Generator Id' && Year = Text(Year(VarFPEstimateData.DateCreated)),
                                {
                                    TotalproposedIncentives: LookUp(
                                        TotalIncentives,
                                        TechnicianID = VarFPEstimateData.'Lead Generator Id' && Year = Text(Year(VarFPEstimateData.DateCreated)),
                                        TotalproposedIncentives
                                    ) + VarFPEstimateData.BidPrice * 0.02,
                                    TotalProposedLead: Value(
                                        LookUp(
                                            TotalIncentives,
                                            TechnicianID = VarFPEstimateData.'Lead Generator Id' && Year = Text(Year(VarFPEstimateData.DateCreated)),
                                            TotalProposedLead
                                        )
                                    ) + 1
                                }
                            );
                        );
                        //total prospective incentive countrows if close
                ,
                //updating sold price and sold incentives
                        LeadSold.Run(
                            glryleadlistLS.Selected.Email,
                            glryleadlistLS.Selected.LeadTrackingNumber,
                            VarLoggedInUser.FullName
                        );
                        UpdateIf(
                            LeadInformations,
                            ID = VarSelectedLead.ID,
                            {
                                LeadEstimateNumber: txtinptestimatenumber.Text,
                                LeadStatus: "Sold",
                                SoldLeadPrice: VarFPEstimateData.BidPrice,
                                SoldLeadIncentives: VarFPEstimateData.BidPrice * 0.02,
                                //TechnicianID: VarFPEstimateData.'Lead Generator Id',
                                StatusDate: Now(),
                                SoldLeadDate: VarFPEstimateData.BookingDate,
                                ProposedLeadPrice: VarFPEstimateData.BidPrice,
                                ProposedLeadIncentives: VarFPEstimateData.BidPrice * 0.02,
                                ProposedLeadDate: VarFPEstimateData.DateCreated
                               // Area:VarFPEstimateData.Area,
                // Territory:VarFPEstimateData.Territory
                            }
                        );
                        If(
                            CountRows(
                                Filter(
                                    TotalIncentives,
                                    TechnicianID = VarFPEstimateData.'Lead Generator Id' && Year = Text(Year(VarFPEstimateData.BookingDate))
                                )
                            ) < 1,
                            Patch(
                                TotalIncentives,
                                Defaults(TotalIncentives),
                                {
                                    ID: GUID(),
                                    TechnicianID: VarFPEstimateData.'Lead Generator Id',
                                    TotalSoldIncentives: VarFPEstimateData.BidPrice * 0.02,
                                    TotalSoldLead: 1,
                                    TotalproposedIncentives: 0.0,
                                    TotalProposedLead: 0,
                                    Year: Year(VarFPEstimateData.BookingDate),
                                    LeadYear: Year(VarFPEstimateData.BookingDate),
                                    YearlyCapReached: If(
                                        (VarFPEstimateData.BidPrice * 0.02) > 10000,
                                        true
                                    )
                                }
                            ),
                            UpdateIf(
                                TotalIncentives,
                                TechnicianID = VarFPEstimateData.'Lead Generator Id' && Year = Text(Year(VarFPEstimateData.BookingDate)),
                                {
                                    TotalSoldIncentives: LookUp(
                                        TotalIncentives,
                                        TechnicianID = VarFPEstimateData.'Lead Generator Id' && Year = Text(Year(VarFPEstimateData.BookingDate)),
                                        TotalSoldIncentives
                                    ) + VarFPEstimateData.BidPrice * 0.02,
                                    TotalSoldLead: Value(
                                        LookUp(
                                            TotalIncentives,
                                            TechnicianID = VarFPEstimateData.'Lead Generator Id' && Year = Text(Year(VarFPEstimateData.BookingDate)),
                                            TotalSoldLead
                                        )
                                    ) + 1,
                                    YearlyCapReached: If(
                                        LookUp(
                                            TotalIncentives,
                                            TechnicianID = VarFPEstimateData.'Lead Generator Id' && Year = Text(Year(VarFPEstimateData.BookingDate)),
                                            TotalSoldIncentives
                                        ) > 10000,
                                        true
                                    )
                                }
                            );
                        );
                        //total sold incentive countrows if close
                    );
                    //sold status if close
                //Set(VarPopUpEstimateNumber,false);
                Set(
                        VarPopUpEstimateNumberSubmittedmsg,
                        "Incentives updated for the estimateId " & LookUp(
                            LeadInformations,
                            ID = VarSelectedLead.ID,
                            LeadEstimateNumber
                        )
                    );
                    Set(
                        VarPopUpEstimateNumberSubmitted,
                        true
                    );
                    Set(
                        VarNavigateDashboardScreen,
                        true
                    );
                    
                );
                //estimatenumber with techid if close
            PressedBorderColor: =RGBA(1, 43, 1, 0)
            PressedFill: =Self.Fill
            Text: ="Yes"
            Visible: =VarPopUpEstimateNumber
            Width: =120
            X: =(Parent.Width-Self.Width)/2.3
            Y: =lblmsgLdS.Y+ lblmsgLdS.Height+10
            ZIndex: =18

        btnnoLdS As button:
            BorderColor: =RGBA(75, 125, 6, 1)
            Fill: =RGBA(54, 176, 75, 1)
            Font: =Font.Arial
            HoverBorderColor: =RGBA(75, 125, 6, 1)
            HoverFill: =RGBA(75, 125, 6, 1)
            OnSelect: |-
                =Reset(txtinptestimatenumber);
                Set(VarPopUpEstimateNumberResult,false);
                Set(VarPopUpEstimateNumber,false);
            PressedBorderColor: =RGBA(1, 43, 1, 0)
            PressedFill: =Self.Fill
            Text: ="No"
            Visible: =VarPopUpEstimateNumber
            Width: =120
            X: =btnyesLdS.X+btnyesLdS.Width+20
            Y: =lblmsgLdS.Y+ lblmsgLdS.Height+10
            ZIndex: =19

    grpEstimateNumberSuccessLdS As group:
        Height: =5
        Width: =5
        X: =40
        Y: =40
        ZIndex: =26

        rectbigsuccessLdS As rectangle:
            Fill: =RGBA(0, 0, 0, 0.29)
            Height: =Parent.Height
            Visible: =VarPopUpEstimateNumberSubmitted
            Width: =Parent.Width
            ZIndex: =20

        rectsuccessLdS As rectangle:
            Fill: =RGBA(255, 255, 255, 1)
            Height: =280
            Visible: =VarPopUpEstimateNumberSubmitted
            Width: =400
            X: =(Parent.Width-Self.Width)/2
            Y: =Parent.Height/3
            ZIndex: =21

        imgsuccessLdS As image:
            Height: =60
            Image: =Success
            ImagePosition: =ImagePosition.Fill
            Visible: =VarPopUpEstimateNumberSubmitted
            Width: =70
            X: =(Parent.Width-Self.Width)/2
            Y: =rectsuccessLdS.Y+20
            ZIndex: =22

        lblmsgsuccessLdS As label:
            Align: =Align.Center
            FontWeight: =FontWeight.Semibold
            Height: =140
            Text: =VarPopUpEstimateNumberSubmittedmsg
            VerticalAlign: =VerticalAlign.Top
            Visible: =VarPopUpEstimateNumberSubmitted
            Width: =350
            X: =(Parent.Width-Self.Width)/2
            Y: =imgsuccessLdS.Y+ imgsuccessLdS.Height+2
            ZIndex: =23

        btnyessuccessLdS As button:
            Fill: =RGBA(54, 176, 75, 1)
            Font: =Font.Arial
            HoverFill: =RGBA(75, 125, 6, 1)
            OnSelect: |-
                =Set(VarPopUpEstimateNumberSubmitted,false);
                Set(VarPopUpEstimateNumber,false);
                If(VarNavigateDashboardScreen=true,Navigate(DashboardScreen));
            PressedBorderColor: =RGBA(1, 43, 1, 0)
            PressedFill: =Self.Fill
            Text: ="OK"
            Visible: =VarPopUpEstimateNumberSubmitted
            Width: =120
            X: =621
            Y: =lblmsgsuccessLdS.Height+lblmsgsuccessLdS.Y
            ZIndex: =24

